<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- font-awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Jquery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Import DataTable Library -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>


</head>


<body>
    <div class="container-fluid bg-light p-2 m-2">
        <!-- Nav bar -->
        <div class="row">
            <div class="col-sm-12">
                <nav class="navbar fixed-top navbar-light bg-warning navbar-expand-lg">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav nav-fill w-100">
                            <li class="nav-item">
                                <a class="nav-link" href="/">Trang Chủ</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/#combo">Combo</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/#pizzaType">Loại pizza</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/#order">Gửi đơn hàng </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/dashboard">Bảng điều hiển </a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="container-fluid mb-5">
            <!-- vùng hiển thị thông tin đơn hàng (order) sau khi order thành công -->
            <div id="modal-ma-don-hang" class="modal fade" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content bg-warning">
                        <div class="modal-header">
                            <h5 class="modal-title">Cảm ơn bạn đã đặt hàng tại Pizza 365. Mã đơn hàng của bạn là:</h5>
                            <button type="button" class="cancel bg-success" data-dismiss="modal">&times;</button>
                        </div>
                        <form class="p-4 mb-2 bg-warning">
                            <div class="row">
                                <div class="col-sm-2">
                                    <label class="form-group">Mã đơn hàng </label>
                                </div>
                                <div id="div-order-code" class="col-sm-10 text-right mb-2">
                                    <input type="text" class="form-control" id="inp-order-code"> </input>
                                </div>
                                <div class="col-sm-12 text-right">
                                    <button id="btn-ok" class="btn btn-success col-sm-5" type="reset"
                                        data-dismiss="modal">OK</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>



        </div>
        <div class="jumbotron container-fluid p-1 m-0">
            <div class="mb-1">
                <h2 class="text-center">Danh sách đơn hàng</h2>
            </div>
            <div class="row form-group">
                <div class="col-sm-2 text-right">
                    <label for="sel-pizza-type" class="col-form-label">Loại Pizza</label>
                </div>
                <div class="col-sm-3">
                    <select id="sel-pizza-type" class="form-control">
                    </select>
                </div>
                <div class="col-sm-2 text-right">
                    <label class="col-form-label">Trạng thái</label>
                </div>
                <div class="col-sm-3">
                    <select id="sel-trang-thai" class="form-control">
                    </select>
                </div>
                <div class="col-sm-2">
                    <button id="btn-filter" class="btn btn-info">Lọc dữ liệu</button>
                </div>
            </div>
        </div>
        <div class="row m-1">
            <button id="btn-add-order" class="btn btn-success"> Add order</button>
        </div>

        <!-- Modal Edit Update Order -->
        <div id="modal-update-order" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit - Update Order</h5>
                        <button type="button" class="cancel" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form class="bg-light p-4 mb-2">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label for="" class="col-form-label">orderCode (Mã đơn hàng) </label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-order-code" disabled
                                                placeholder="Mã đơn hàng....">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label for="" class="col-form-label">Kích cỡ Combo</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-kich-co-combo"
                                                disabled placeholder="Kích cỡ Combo..." />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Đường kính Pizza</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-duong-kinh-pizza"
                                                disabled placeholder="Đường kính Pizza....">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Sườn nướng (miếng)</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-suon" disabled
                                                placeholder="Sườn nướng (miếng)....">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Salad</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-salad" disabled
                                                placeholder="Salad....">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Loại Pizza</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-loai-pizza" disabled
                                                placeholder="Loại Pizza....">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Mã voucher</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-id-vourcher" disabled
                                                placeholder="Voucher ID (mã voucher).....">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Thành tiền</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-thanh-tien" disabled
                                                placeholder="Thành tiền....">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Giảm giá</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="inp-update-giam-gia" disabled
                                                placeholder="Giảm giá.....">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label" for="">id Loại nước uống</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-id-loai-nuoc-uong" class="form-control"
                                                placeholder="id Loại nước uống..." disabled>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label for="" class="col-form-label">Số lượng nước</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-so-luong-nuoc" class="form-control"
                                                disabled placeholder="Số lượng đồ uống....">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label" for="">Họ tên</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-ho-ten" class="form-control" disabled
                                                placeholder="Họ và tên...">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label for="" class="col-form-label">Email</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input id="inp-update-email" type="email" class="form-control" disabled
                                                placeholder="Email...">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Số điện thoại</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-so-dien-thoai" class="form-control"
                                                disabled placeholder="Số điện thoại...">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Địa chỉ</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-dia-chi" class="form-control" disabled
                                                placeholder="Địa chỉ...">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Lời nhắn</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-loi-nhan" class="form-control" disabled
                                                placeholder="Lời nhắn...">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Trạng thái</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-trang-thai" class="form-control" disabled
                                                placeholder="Trạng thái...">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Ngày tạo</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-ngay-tao" class="form-control" disabled
                                                placeholder="Ngày tạo...">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Ngày cập nhật</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="inp-update-ngay-cap-nhat" class="form-control"
                                                disabled placeholder="Ngày cập nhật...">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" id="btn-confirm-order" class="btn btn-success">Confirm</button>
                        <button type="button" id="btn-modal-cancel" class="btn btn-danger">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal create order -->
        <div id="modal-create-order" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create Order</h5>
                        <button type="button" class="cancel" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form class="bg-light p-4 mb-2">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label for="" class="col-form-label">Kích cỡ Combo</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <select type="text" class="form-control" id="sel-kich-co"
                                                placeholder="Kích cỡ Combo...">
                                                <option value="0"></option>
                                                <option value="S">S</option>
                                                <option value="M">M</option>
                                                <option value="L">L</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Đường kính Pizza</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="number" class="form-control" id="input-duong-kinh" disabled
                                                placeholder="Đường kính Pizza....">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Sườn nướng (miếng)</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="number" disabled class="form-control" id="input-suon"
                                                placeholder="Sườn nướng (miếng)....">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Salad</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="number" class="form-control" id="input-salad" disabled
                                                placeholder="Salad....">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label for="" class="col-form-label">Số lượng nước</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="number" id="input-so-luong-nuoc" class="form-control" disabled
                                                placeholder="Số lượng nước">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Thành tiền</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="number" id="input-thanh-tien" disabled class="form-control"
                                                placeholder="Thành tiền....">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">

                                        <div class="col-sm-4">
                                            <label class="col-form-label">Loại Pizza</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="sel-loai-pizza">
                                                <option value="0"></option>
                                                <option value="Seafood">Hải sản</option>
                                                <option value="Hawaii">Hawaii</option>
                                                <option value="Bacon">Thịt hun khói</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label" for="">id Loại nước uống</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="select-drink" placeholder="">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Mã voucher</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="input-id-vourcher"
                                                placeholder="Voucher ID (mã voucher).....">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label" for="">Họ tên</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="input-ho-ten" class="form-control"
                                                placeholder="Họ và tên...">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label for="" class="col-form-label">Email</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input id="input-email" type="email" class="form-control"
                                                placeholder="Email...">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Số điện thoại</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="input-so-dien-thoai" class="form-control"
                                                placeholder="Số điện thoại...">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Địa chỉ</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <input type="text" id="input-dia-chi" class="form-control"
                                                placeholder="Địa chỉ...">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <div class="col-sm-4">
                                            <label class="col-form-label">Trạng thái</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <select id="select-trang-thai" class="form-control">
                                                <option value="open">Open</option>
                                                <option value="cancel">Đã hủy</option>
                                                <option value="confirmed">Đã xác nhận</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="row form-group">
                                        <div class="col-sm-2">
                                            <label class="col-form-label">Lời nhắn</label>
                                        </div>
                                        <div class="col-sm-10">
                                            <input type="text" id="input-loi-nhan" class="form-control"
                                                placeholder="Lời nhắn...">
                                        </div>
                                    </div>
                                </div>
                            </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn-tao-don" class="btn btn-warning col-sm-2">Tạo đơn</button>
                        <button type="submit" id="btn-quay-lai" class="btn btn-danger col-sm-2"
                            data-dismiss="modal">Quay lại</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal delete-order -->
        <div id="modal-delete-order" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Cảnh báo xóa order</h3>
                        <button type="button" class="cancel" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div>
                            <h4>Bạn có chắc muốn xóa order này không</h4>
                        </div>
                        <div class="modal-footer">
                            <button id="btn-xoa-order" class="btn btn-danger col-sm-2" data-dismiss="modal">Chắc
                                chắn</button>
                            <button id="btn-cancel-delete" class="btn btn-dark col-sm-2" data-dismiss="modal">Quay
                                lại</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Order Table -->
        <table id="order-table" class="table table-bordered table-striped table-hover">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Kích cỡ Combo</th>
                    <th>Loại Pizza</th>
                    <th>Nước uống</th>
                    <th>Họ và tên</th>
                    <th>Số điện thoại</th>
                    <th>Trạng thái</th>
                    <th>Chi tiết</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
</body>
<!-- Footer -->
<footer class="container bg-light text-center p-5">
    <h4>Footer</h4>
    <a href="#" class="btn btn-dark"><i class="fa fa-arrow-up mr-3"></i>To the top</a>
</footer>

</html>
<script>
    $(document).ready(function () {
        'use strict';
        /*** REGION 1 - Global variables - Vùng khai báo biến, hằng số, tham số TOÀN CỤC */
        // Biến toàn cục định nghĩa chỉ số các cột tương ứng
        const gNAME_COL = ["orderCode", "pizzaSize", "pizzaType", "drink", "user.fullName", "user.phone", "status"]
        const gORDER_CODE_COL = 0;
        const gKICH_CO_COL = 1;
        const gLOAI_PIZZA_COL = 2;
        const gNUOC_UONG_COL = 3;
        const gHO_VA_TEN_COL = 4;
        const gSO_DIEN_THOAI_COL = 5;
        const gTRANG_THAI_COL = 6;
        const gCHI_TIET_COL = 7;
        // Gán các hằng số cần dùng gọi sever
        const gBASE_URL = "pizza365/orders";
        var gIdDetail;
        var gOrderCodeDetail;
        var gIdDelete;

        // mảng pizza Type
        var gPizzaType = [{
            value: "Seafood",
            text: "Hải sản"
        }, {
            value: "Hawaii",
            text: "Hawaii"
        }, {
            value: "Bacon",
            text: "Thịt hun khói"
        }];

        // mảng trạng thái
        var gStatus = [{
            value: "open",
            text: "Open"
        }, {
            value: "confirmed",
            text: "Đã xác nhận"
        }, {
            value: "cancel",
            text: "Đã hủy"
        }];

        // định nghĩa table  - chưa có data
        var gOrderData;
        var gOrderTable = $("#order-table").DataTable({
            // Khai báo các cột của datatable
            "columns": [{
                "data": gNAME_COL[gORDER_CODE_COL]
            }, {
                "data": gNAME_COL[gKICH_CO_COL]
            }, {
                "data": gNAME_COL[gLOAI_PIZZA_COL]
            }, {
                "data": gNAME_COL[gNUOC_UONG_COL]
            }, {
                "data": gNAME_COL[gHO_VA_TEN_COL]
            }, {
                "data": gNAME_COL[gSO_DIEN_THOAI_COL]
            }, {
                "data": gNAME_COL[gTRANG_THAI_COL]
            },
            {
                "data": gNAME_COL[gCHI_TIET_COL]
            }],
            "columnDefs": [
                //     {
                //     "targets": gLOAI_PIZZA_COL,
                //     "render": convertToPizzaText
                // },
                {
                    "targets": gCHI_TIET_COL,
                    "defaultContent": //"<button class='info-order btn btn-info'>Chi tiết</button>"
                        `<i class="fas fa-edit btn-edit-order" style="cursor: pointer;" data-toggle="tooltip" title="Edit">&nbsp;</i>
                     <i class="fas fa-trash-alt btn-delete-order" style="cursor: pointer;" data-toggle="tooltip" title="Delete"></i>`
                }]
        })

        /*** REGION 2 - Vùng gán / thực thi hàm xử lý sự kiện cho các elements */
        //Hàm thực thi khi loading trang
        onPageLoading();
        //Load dữ liệu vào ô select pizz
        loadPizzaTypesToSelect(gPizzaType);
        //Load dữ liệu vào ô select status
        loadStatusToSelect(gStatus);
        //gọi API load dữ liệu nước ngọt
        loadDrinkListFromSever();
        // Gán sự kiện click cho nút add-order
        $("#btn-add-order").on("click", function () {
            onBtnAddOrderClick(); // this là button được ấn
        });
        //Hàm thực hiện khi click tạo đơn
        $('#btn-tao-don').on("click", function () {
            onBtnTaoDonClick();
        });
        // Gán sự kiện click cho nút edit-order
        $("#order-table").on("click", ".btn-edit-order", function () {
            onBtnEditClick(this); // this là button được ấn
        });
        // Gán sự kiện click cho nút info-order
        $("#order-table").on("click", ".btn-delete-order", function () {
            onBtnDeleteClick(this);
        });
        // Gán sự kiện click cho nút filter
        $('#btn-filter').click(onBtnFilterClick);
        // Gán sự kiện click cho nút confirm
        $('#btn-confirm-order').click(onBtnConfirmClick);
        // Gán sự kiện click cho nút cancel 
        $('#btn-modal-cancel').click(onBtnCancelClick);
        //Gán sự kiện cho ô chọn kích cỡ pizza
        $("#sel-kich-co").on("change", function () {
            onSelectKichCoChange();
        });
        //Gán sự kiện cho nút xóa order
        $('#btn-xoa-order').on("click", function () {
            callApiDeleteOrder();
        });
        /*** REGION 3 - Event handlers - Vùng khai báo các hàm xử lý sự kiện */

        //Xử lý nút delete khi click
        function onBtnDeleteClick(paramEditBtn) {
            "use strict"
            console.log("%c Nút xóa Order được nhấn", "color: yellow")
            //Xác định thẻ tr là cha của nút được chọn
            var vRowSelected = $(paramEditBtn).parents('tr');
            //Lấy datatable row
            var vDataTableRow = gOrderTable.row(vRowSelected);
            //Lấy data của dòng 
            var vOrderData = vDataTableRow.data();
            //Ghi dữ liệu hàng ra console
            debugger
            console.log(vOrderData);
            gIdDelete = vOrderData._id;
            gOrderCodeDetail = vOrderData.orderCode;
            $('#modal-delete-order').modal()
        }

        //Call API create New Order 
        function onBtnTaoDonClick() {
            'uses strict'
            //Tạo biến chứa thông tin dữ liệu
            var vNewOrder = {};
            //Thu thập dữ liệu
            getNewOrderData(vNewOrder);
            //Valid dữ liệu
            var vValid = validDataModal(vNewOrder);
            //Gửi dữ liệu đến Sever tạo order
            if (vValid) {
                //Call API create New Order 
                createNewOrder(vNewOrder)
            }
        }

        //Hàm thực thi khi nhấn add order
        function onBtnAddOrderClick() {
            //Hiện modal lên
            $('#modal-create-order').modal()
        }

        //Hàm thực hiện khi nhấn confirm
        function onBtnConfirmClick() {
            "use strict"
            console.log("Nút confirm được nhấn");
            console.log({
                gIdDetail,
                gOrderCodeDetail
            });
            //gọi server update status
            updateOrderClick(gIdDetail, "confirmed");
        }

        //Hàm thực hiện khi nhấn cancer
        function onBtnCancelClick() {
            "use strict"
            //gọi server update
            updateOrderClick(gIdDetail, "cancel");
        }

        // Hàm khi bấm nút filter
        function onBtnFilterClick() {
            "use strict"
            // Thu thập dữ liệu
            var vFilterData = getDataFromForm();
            // Kiểm tra dữ liệu
            if (vFilterData.pizzaType == "0" && vFilterData.status == "0") {
                onPageLoading();
                return;
            }
            // Filter theo filter data
            handleFilter(vFilterData);
        }

        //Hàm thực thi khi nhấn Edit
        function onBtnEditClick(paramEditBtn) {
            "use strict"

            console.log("%c Nút chi tiết được nhấn", "color: yellow")
            //Xác định thẻ tr là cha của nút được chọn
            var vRowSelected = $(paramEditBtn).parents('tr');
            //Lấy datatable row
            var vDataTableRow = gOrderTable.row(vRowSelected);
            //Lấy data của dòng 
            var vOrderData = vDataTableRow.data();
            //Ghi dữ liệu hàng ra console
            gIdDetail = vOrderData._id;
            gOrderCodeDetail = vOrderData.orderCode;
            console.log({
                gIdDetail,
                gOrderCodeDetail
            });
            //Get Data from  API
            getOrderById(gIdDetail);
        }

        //Hàm khi loading
        function onPageLoading() {
            "use strict";
            callApiGetData();
        }

        /*** REGION 4 - Common funtions - Vùng khai báo hàm dùng chung trong toàn bộ chương trình*/
        //Hàm load status vào ô select
        function loadStatusToSelect(paramData) {
            "use strict";
            $('#sel-trang-thai').append($('<option>', {
                value: "",
                text: '== Chọn trạng thái =='
            }));
            for (var bI = 0; bI < paramData.length; bI++) {
                $('#sel-trang-thai').append($('<option>', {
                    value: paramData[bI].value,
                    text: paramData[bI].text
                }));
            }
        }

        // load data to table
        function loadDataToTable(paramResponseObject) {
            "use strict"
            //Xóa toàn bộ dữ liệu đang có của bảng
            gOrderTable.clear();
            //Cập nhật data cho bảng 
            gOrderTable.rows.add(paramResponseObject);
            //Cập nhật lại giao diện hiển thị bảng
            gOrderTable.draw();
        }

        //Hàm lấy dữ liệu trên form
        function getDataFromForm() {
            "use strict"
            return {
                pizzaType: $('#sel-pizza-type').val(),
                status: $('#sel-trang-thai').val()
            }
        }

        //Hàm lọc dữ liệu
        function handleFilter(paramFilterData) {
            const { pizzaType, status } = paramFilterData;
            console.log({ pizzaType, status })
            const vResultArr = gOrderData.filter(order => (
                (!pizzaType || order.pizzaType && order.pizzaType.toLowerCase() === pizzaType.toLowerCase()) &&
                (!status || order.status && order.status.toLowerCase() === status.toLowerCase())
            ));
            loadDataToTable(vResultArr);
        }

        //Hàm load PizzaType vào ô select
        function loadPizzaTypesToSelect(paramData) {
            "use strict";
            $('#sel-pizza-type').append($('<option>', {
                value: "",
                text: '== Chọn loại Pizza =='
            }));
            for (var bI = 0; bI < paramData.length; bI++) {
                $('#sel-pizza-type').append($('<option>', {
                    value: paramData[bI].value,
                    text: paramData[bI].text
                }));
            }
        }


        //gọi mẫu get order by ID
        function getOrderById(paramOrderId) {
            "use strict";
            // lấy data từ server
            $.ajax({
                url: gBASE_URL + "/" + paramOrderId,
                type: "GET",
                dataType: 'json',
                success: function (responseObject) {
                    //Lưu vào biến toàn cục 
                    var vOrderData = responseObject.data;
                    //Load data to modal
                    loadDataToDetailModal(vOrderData);
                    //Hiện modal lên
                    $('#modal-update-order').modal()
                },
                error: function (error) {
                    console.assert(error.responseText);
                }
            });
        }

        //Hàm gọi API lấy dữ liệu order
        function callApiGetData() {
            "use strict"
            // lấy data từ server
            $.ajax({
                url: gBASE_URL,
                type: "GET",
                dataType: 'json',
                success: function (responseObject) {
                    //Lưu vào biến toàn cục 
                    gOrderData = responseObject.data;
                    //task in ra console
                    console.log(gOrderData);
                    //load dữ liệu vào bảng
                    loadDataToTable(gOrderData);
                },
                error: function (error) {
                    console.assert(error.responseText);
                }
            });
        }

        //confirm hoặc cancel 01 order (update)
        function updateOrderClick(paramOrderId, paramStatus) {
            "use strict"
            // Update dữ liệu lên server
            $.ajax({
                url: gBASE_URL + "/" + paramOrderId,
                type: 'PUT',
                data: JSON.stringify({
                    status: paramStatus
                }),
                dataType: 'json', // added data type
                contentType: "application/json;charset=UTF-8",
                success: function (data) {
                    // xử lý data display
                    clearModalForm();
                    $('#modal-update-order').modal("hide");
                    //Trà lại các giá trị cho ô search
                    $('#sel-pizza-type').val("0");
                    $('#sel-trang-thai').val("0");
                    //Load lại Data
                    callApiGetData();
                }
            });
        }

        //Load data to modal
        function loadDataToDetailModal(paramOrderObject) {
            $("#inp-update-order-code").val(paramOrderObject.orderCode);
            $("#inp-update-kich-co-combo").val(paramOrderObject.pizzaSize);
            $("#inp-update-duong-kinh-pizza").val(paramOrderObject.duongKinh);
            $("#inp-update-suon").val(paramOrderObject.suon);
            $("#inp-update-salad").val(paramOrderObject.salad);
            $("#inp-update-loai-pizza").val(paramOrderObject.pizzaType);
            $("#inp-update-id-vourcher").val(paramOrderObject.voucher);
            $("#inp-update-thanh-tien").val(paramOrderObject.thanhTien);
            $("#inp-update-giam-gia").val(paramOrderObject.giamGia);
            $("#inp-update-id-loai-nuoc-uong").val(paramOrderObject.drink);
            $("#inp-update-so-luong-nuoc").val(paramOrderObject.soLuongNuoc);
            $("#inp-update-ho-ten").val(paramOrderObject.user.fullName);
            $("#inp-update-email").val(paramOrderObject.user.email);
            $("#inp-update-so-dien-thoai").val(paramOrderObject.user.phone);
            $("#inp-update-dia-chi").val(paramOrderObject.user.address);
            $("#inp-update-loi-nhan").val(paramOrderObject.user.loiNhan);
            $("#inp-update-trang-thai").val(paramOrderObject.status);
            $("#inp-update-ngay-tao").val(paramOrderObject.createdAt);
            $("#inp-update-ngay-cap-nhat").val(paramOrderObject.updatedAt);
        }

        // Hàm clear create form
        function clearModalForm() {
            "use strict"
            $("#inp-order-code").val("");
            $("#inp-kich-co-combo").val("");
            $("#inp-duong-kinh-pizza").val("");
            $("#inp-suon").val("");
            $("#inp-salad").val("");
            $("#inp-loai-pizza").val("");
            $("#inp-id-vourcher").val("");
            $("#inp-thanh-tien").val("");
            $("#inp-giam-gia").val("");
            $("#inp-id-loai-nuoc-uong").val("");
            $("#inp-so-luong-nuoc").val("");
            $("#inp-ho-ten").val("");
            $("#inp-email").val("");
            $("#inp-so-dien-thoai").val("");
            $("#inp-dia-chi").val("");
            $("#inp-loi-nhan").val("");
            $("#inp-trang-thai").val("");
            $("#inp-ngay-tao").val("");
            $("#inp-ngay-cap-nhat").val("");
        }

        //Get data from modal
        function getDataModal() {
            "use strict"
            return {
                orderCode: $("#inp-order-code").val().trim(),
                pizzaSize: $("#inp-kich-co-combo").val().trim(),
                duongKinh: $("#inp-duong-kinh-pizza").val().trim(),
                suon: $("#inp-suon").val().trim(),
                salad: $("#inp-salad").val().trim(),
                pizzaType: $("#inp-loai-pizza").val().trim(),
                idVourcher: $("#inp-id-vourcher").val().trim(),
                thanhTien: $("#inp-thanh-tien").val().trim(),
                giamGia: $("#inp-giam-gia").val().trim(),
                drink: $("#inp-id-loai-nuoc-uong").val().trim(),
                soLuongNuoc: $("#inp-so-luong-nuoc").val().trim(),
                fullName: $("#inp-ho-ten").val().trim(),
                email: $("#inp-email").val().trim(),
                phone: $("#inp-so-dien-thoai").val().trim(),
                address: $("#inp-dia-chi").val().trim(),
                loiNhan: $("#inp-loi-nhan").val().trim(),
                status: $("#inp-trang-thai").val().trim(),
                ngayTao: $("#inp-ngay-tao").val().trim(),
                ngayCapNhat: $("#inp-ngay-cap-nhat").val().trim(),
            }
        }

        //valid phone number
        function isPhoneNumber(inputtxt) {
            var vValidNumber = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
            return inputtxt.match(vValidNumber)
        }

        //valid Email
        function isEmail(paramEmail) {
            "use strict";
            return paramEmail.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);
        }

        //Check Email Format
        function checkEmailFomat(paramEmail) {
            if (!(isEmail(paramEmail))) {
                alert("Email chưa đúng định dạng");
                return false
            }
            return true
        }

        //Valid Data
        function validDataModal(paramThongTinGuiDon) {
            'use strict'
            if (paramThongTinGuiDon.pizzaSize == "0") {
                alert("Bạn chưa chọn Combo");
                return false
            }
            if (paramThongTinGuiDon.pizzaType == "0") {
                alert("Bạn chưa chọn Kiểu Pizza");
                return false
            }
            if (paramThongTinGuiDon.drink == "0") {
                alert("Bạn chưa chọn Loại Nước Ngọt");
                return false
            }
            if (paramThongTinGuiDon.fullName.trim() == "") {
                alert("Bạn chưa nhập họ tên");
                return false
            }
            if (!isPhoneNumber(paramThongTinGuiDon.phone)) {
                alert("Số điện thoại không hợp lệ");
                return false
            }
            if (paramThongTinGuiDon.email.trim() != "") {
                var vEmail = paramThongTinGuiDon.email.trim();
                return checkEmailFomat(vEmail);
            }
            if (paramThongTinGuiDon.address.trim() == "") {
                alert("Bạn chưa nhập địa chỉ");
                return false
            }
            if (paramThongTinGuiDon.status == "") {
                alert("Bạn chưa nhập trạng thái");
                return false
            }
            return true
        }

        // Hàm lấy danh sách các loại nước uống từ sever load để load api
        function loadDrinkListFromSever() {
            "use strict";
            // lấy data từ server   
            $.ajax({
                url: "pizza365/drinks",
                type: "GET",
                dataType: 'json',
                success: function (responseObject) {
                    console.log(responseObject);
                    //Load data to modal
                    loadDataToDrinkSelect(responseObject);
                    //Hiện modal lên
                    console.log("Finished load drink")
                },
                error: function (error) {
                    console.assert(error.responseText);
                }
            });
        };

        //Load Data To Drink Selectbox
        function loadDataToDrinkSelect(paramDataObj) {
            "use strict";
            $('#select-drink').append($('<option>', {
                value: 0,
                text: '== Chọn loại nước uống =='
            }));
            for (var bI = 0; bI < paramDataObj.length; bI++) {
                $('#select-drink').append($('<option>', {
                    value: paramDataObj[bI].maNuocUong,
                    text: paramDataObj[bI].tenNuocUong
                }));
            }
        }

        //  hàm xử lý sự kiện car select change
        function onSelectKichCoChange() {
            // B1: thu thập dữ liệu
            var vKichCo = $("#sel-kich-co").val();
            // B3: hiển thị car types lên select
            loadComboBySize(vKichCo);
        }

        // hàm load dữ liệu combo bang kich co
        function loadComboBySize(paramCarBrandId) {
            if (paramCarBrandId == "S") {
                getCombo(20, 2, 200, 2, 150000);
            }
            if (paramCarBrandId == "M") {
                getCombo(25, 4, 300, 3, 200000);

            }
            if (paramCarBrandId == "L") {
                getCombo(30, 8, 500, 4, 250000);

            }
            if (paramCarBrandId == "0") {
                getCombo("", "", "", "", "");
            }
        }

        //Hàm lấy thông tin ComBo 
        function getCombo(paramDuongKinh, paramSuon, paramSalad, paramSoLuongNuoc, paramPrice) {
            $('#input-duong-kinh').val(paramDuongKinh);
            $('#input-suon').val(paramSuon);
            $('#input-salad').val(paramSalad);
            $('#input-so-luong-nuoc').val(paramSoLuongNuoc);
            $('#input-thanh-tien').val(paramPrice);
        };

        //Call API create New Order 
        function createNewOrder(paramOrderInfo) {
            "use strict"
            $.ajax({
                url: gBASE_URL,
                type: 'POST',
                data: JSON.stringify(paramOrderInfo),
                dataType: 'json', // added data type
                contentType: "application/json;charset=UTF-8",
                success: function (data) {
                    //Ẩn modal
                    $('#modal-create-order').modal('hide');
                    $('#inp-order-code').val(data.orderCode)
                    $('#modal-ma-don-hang').modal()
                    //load lại trang
                    onPageLoading();
                }
            });
        }

        // //Convert value to Pizza text
        // function convertToPizzaText(paramData) {
        //     var vPizzaText = "";
        //     for (let index = 0; index < gPizzaType.length; index++) {
        //         if (paramData == gPizzaType[index].value) {
        //             vPizzaText = gPizzaType[index].text
        //         }
        //     }
        //     return vPizzaText;
        // }

        // Hàm lấy thông tin từ trường input
        function getNewOrderData(paramObject) {
            paramObject.pizzaSize = $('#sel-kich-co option:selected').val();
            paramObject.duongKinh = $('#input-duong-kinh').val();
            paramObject.suon = $('#input-suon').val();
            paramObject.salad = $('#input-salad').val();
            paramObject.soLuongNuoc = $('#input-so-luong-nuoc').val();
            paramObject.thanhTien = $('#input-thanh-tien').val();
            paramObject.pizzaType = $('#sel-loai-pizza option:selected').val();
            paramObject.voucher = $('#input-id-vourcher').val();
            paramObject.drink = $('#select-drink option:selected').val();
            paramObject.fullName = $('#input-ho-ten').val();
            paramObject.email = $('#input-email').val();
            paramObject.phone = $('#input-so-dien-thoai').val();
            paramObject.address = $('#input-dia-chi').val();
            paramObject.status = $('#select-trang-thai').val();
            paramObject.loiNhan = $('#input-loi-nhan').val();
            console.log(paramObject)
        };

        //Call API To Delete Order
        function callApiDeleteOrder() {
            debugger;
            $.ajax({
                url: gBASE_URL + "/" + gIdDelete,
                type: 'DELETE',
                dataType: 'json',
                success: function (data) {
                    debugger
                    alert("Đã xóa thành công")
                    onPageLoading();
                },
                error: function () {
                    console.log('Error in Operation');
                }
            });
        }
    });
</script>